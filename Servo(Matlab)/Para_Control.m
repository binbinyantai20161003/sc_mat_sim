%%% Parameters setting for closed feedback controller%% Parameters of Hardware %%%%%%%%%%%fcar=8e3;                                                                  %%[Hz] Frequency of Carrier Tcar=1/fcar;                                                               %%[s] Period of Carrier Tsr=125e-6;                                                                %Sampling time of referenceTsf=125e-6;                                                                %Sampling time of position loopTsv=125e-6;                                                                %Sampling time of velocity loopTsi=Tcar;                                                                  %Sampling time of current loopTsp=Tsi;                                                                   %Sampling time of physical modelTs = Tsp;                                                                  %matlab simulink parameter max step size (varible step method)E1=220*sqrt(3)*sqrt(2);                                                    %voltage of DC Em=E1-0;                                                                   %voltage of DC Little tunning Upm=Em/2;                                                                  %maximum voltage of phasesUlm=Upm*sqrt(3);                                                           %maximum voltage of lines Wrmax=Upm/KEp*2/(1+sqrt(3)/2);                                             %max speed  根据反电动势系数                                                       Igbt_max = Iq_pk*3;                                                        %three times Iq is the max current value for the igbt used for field-weakingRes_Ia=Iq_pk*3/2^24;                                                       %[A] Resolution of current measurement change for 3 times rated current peek valueRes_Qm=2*pi/2^24;                                                          %[rad] Resolution of pos measurement%% Parameter of used in Controller %%%%%%%%%%%Ldo=Ld; Lqo=Lq; Rao=Ra; Jo=Jm; Ofqo=Ofq; KTo=KT; KEo=KTo;                  %make the motor parameter used in controller%% Parameter of Reference  %%%%%%%%%%%%we can choose filter used in the referenceT_cic_r=100e-3; %125e-6;                                                   %Time of CIC Filter of referenceT_lpf_r=500e-3;                                                            %time constant of reference LPF%% Parameter of Pos loop  %%%%%%%%%%%Kpp=20;                                                                   %pos loop gain kp Kvff=1;                                                                    %vel feedforwardKaff=0;                                                                    %acc feedforward%% Parameter of velocity loopPI_IP=1;                                                                   %0: IP  Control, 1: PI Controleta=0.707;                                                                     % damping ratiofcv=100;                                                                   % velocity loop bandwith (HZ)                                                                   wcv=2*pi*fcv;                                                              % velocity loop bandwith (rad/s) % when D = 0 kp ti methodKpv=2*eta*wcv;                                                             % velocity loop kpTiv=2*eta/wcv;                                                             % velocity loop integral time constantTf=Tsi*3;                                                                 % velocity loop output one low pass filter time constant Trmax=Te_rtd*3;                                                            % torque limitSvm=Trmax/Jo;%% Parameter of current loopIdr=0;                                                                     %[A] current command of d axisfci=1000;                                                                  % current loop bandwithKiq=2*pi*fci;                                                              % current loop q axis kpTiq=Lqo/Rao;                                                               % current loop q axis tiKid=Kiq;                                                                   % current loop d axis kp because ld and lq mutiply seperately in the loop                                 Tid=Ldo/Rao;                                                               % current loop d axis tiUrm=Upm*2*K_3T2;                                                           %Maximum of Ur=sqrt(Ud^2+Uq^2) 1.333*upmUdm=Urm; Uqm=Urm;                                                          %Maximum voltage of dq axis Uidm=Udm; Uiqm=Uqm;                                                        %Maximum voltage of dq axis integralVoltCom_sw=2;                                                              %Voltage compensation; 1:type 1, 2:type 3, 3:noT_lpf_fw_ud=3*Tsi;                                                         % ud fw filter time constantT_lpf_fw_uq=3*Tsi;                                                         % uq fw filter time constantv_sat_fw = Upm*0.8;                                                        % fw sature compare valuefw_kp = 0.2;                                                               % fw kp kp小一点，ki大一点比较稳定，kp大了补偿d轴电流容易震荡fw_ki = 500;                                                               % fw kifw_uplimit = 25;                                                           % [A]fw up limit fw_downlimit = 0;                                                          % [A]fw low limit